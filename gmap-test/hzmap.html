<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Google Maps JavaScript API v3 Example: Polygon Simple</title>
		<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script>
			function loadData() {
				var url = "proj/unit/0.json";
				// var url = "proj/ghj_map/10.json";
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", url, false);
				xmlhttp.send();
				var layer = JSON.parse(xmlhttp.responseText)
				return layer;
			}

			function getLatLngArr(arr) {
				var gmap_arr = [];
				for(var i = 0; i < arr.length; i++) {
					gmap_arr[i] = new google.maps.LatLng(arr[i][1], arr[i][0]);
				}
				return gmap_arr;
			}

			function getLatLngArrs(arrs) {
				var gmap_arrs = [];
				for(var i = 0; i < arrs.length; i++) {
					var arr = arrs[i];
					var gmap_arr = [];
					for(var j = 0; j < arr.length; j++) {
						gmap_arr[j] = new google.maps.LatLng(arr[j][1], arr[j][0]);
					}
					gmap_arrs[i] = gmap_arr;
				}
				return gmap_arrs;
			}

			function initialize() {
				var myLatLng = new google.maps.LatLng(30.23, 120.18);
				var myOptions = {
					zoom : 10,
					center : myLatLng,
					mapTypeId : google.maps.MapTypeId.ROADMAP
				};

				var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

				var layer = loadData();
				var geotype = layer.geometryType;
				var features = layer.features;

				document.getElementById("info").innerText = features.length;

				for(var k = 0; k < features.length; k++) {
					if(geotype == "esriGeometryPoint") {
						var myLatlng = new google.maps.LatLng(features[k].geometry.y, features[k].geometry.x);
						var name = features[k].attributes.NAME;

						var marker = new google.maps.Marker({
							position : myLatlng,
							map : map,
							title : name
						});

					} else if(geotype == "esriGeometryPolyline") {
						var paths = features[k].geometry.paths;
						for(var i = 0; i < paths.length; i++) {
							var gmap_path = getLatLngArr(paths[i]);

							var polyline = new google.maps.Polyline({
								path : gmap_path,
								strokeColor : "#FF0000",
								strokeOpacity : 0.8,
								strokeWeight : 2
							});
							polyline.setMap(map);
						}

					} else if(geotype == "esriGeometryPolygon") {
						var gmap_rings = getLatLngArrs(features[k].geometry.rings);

						var polyon = new google.maps.Polygon({
							paths : gmap_rings,
							strokeColor : "#FF0000",
							strokeOpacity : 0.8,
							strokeWeight : 2,
							fillColor : "#FF0000",
							fillOpacity : 0.35
						});
						polyon.setMap(map);
					}
				}
			}
		</script>
	</head>
	<body onload="initialize()">
		<div id="map_canvas" style="width: 800px; height: 600px"></div>
		<div id="info"></div>
	</body>
</html>
